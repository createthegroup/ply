<!DOCTYPE html>  <html> <head>   <title>ajax.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="ajax.html">                 ajax.js               </a>                                           <a class="source" href="config.html">                 config.js               </a>                                           <a class="source" href="core.html">                 core.js               </a>                                           <a class="source" href="read.html">                 read.js               </a>                                           <a class="source" href="ui.html">                 ui.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               ajax.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*global Ply, jQuery */</span>
<span class="cm">/*jshint eqeqeq: true, curly: true, white: true */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The Ajax module is a simple wrapper around jQuery's <code>ajax</code> method.
The goal is to provide an abstracted API, allowing us to switch out the implementation
underneath. Since all Ajax requests go through this mechanism, we can catch all Ajax errors
and log them in one place, as well as do things like modify the data that is sent to the server.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Define the <code>ajax</code> module.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Ply</span><span class="p">.</span><span class="nx">ajax</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">return</span> <span class="p">{</span>

        <span class="nx">request</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">failure</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Create alias for request to avoid reference errors.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">r</span>    <span class="o">=</span> <span class="nx">request</span> <span class="o">||</span> <span class="p">{},</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Default to <code>GET</code> request if no type is explicitly given.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">type</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">type</span>  <span class="o">||</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
                <span class="nx">url</span>  <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">url</span>   <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="nx">data</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">data</span>  <span class="o">||</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Send along a <code>debug</code> parameter on all requests
if debug mode is enabled.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">Ply</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">debugOn</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">data</span><span class="p">.</span><span class="nx">debug</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Surround ajax request in a try/catch block to catch any possible errors.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">try</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                    <span class="nx">type</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span>
                    <span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
                    <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">,</span>
                    <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Call the <code>success</code> callback with the response.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="k">if</span> <span class="p">(</span><span class="nx">success</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">success</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">success</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
                        <span class="p">}</span>

                    <span class="p">},</span>
                    <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>On error, log an AjaxError to the the <code>console</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">Ply</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;AjaxError: &#39;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">,</span> <span class="s1">&#39;warn&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Call the <code>error</code> method on the core module. Will post the error data
to the logging server.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">Ply</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">error</span><span class="p">({</span>
                            <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;AjaxError&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Send the status code in the message.</p>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Status: &#39;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
                            <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;URL: &#39;</span> <span class="o">+</span> <span class="nx">url</span>
                        <span class="p">},</span> <span class="mi">1</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Call the <code>failure</code> callback function if one is provided.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="k">if</span> <span class="p">(</span><span class="nx">failure</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">failure</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">failure</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
                        <span class="p">}</span>

                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Log and post any error that may have occurred.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">Ply</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ex</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="nx">Ply</span><span class="p">.</span><span class="nx">core</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">ex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="p">}</span>

    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Alias <code>jQuery</code> to <code>$</code> for the module's scope.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Read about the <a href="read.html">Read</a> module next.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 