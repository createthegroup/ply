window.Ply={VERSION:"0.2.3"};
Ply.core=function(){var c={},b=!1;return{notify:function(a,d,b){for(var f=c[a]||(c[a]=[]),h=0,e=f.length;h<e;h++)f[h].handler.call(f[h].listener,a,d,b)},listen:function(a,d,b){var f=c[a]||(c[a]=[]),a=a.split(/\s/),h=a.length,e=0;if(h>1)for(;e<h;e++)this.listen(a[e],d,b);else f.push({handler:d,listener:b})},log:function(a,d){if(b&&window.console)switch(d){case "warn":console.warn(a);break;case "info":console.info(a);break;default:console.log(a)}},error:function(a,b){if(Ply.config.core.onError&&typeof Ply.config.core.onError===
"function")Ply.config.core.onError(a,b);else throw a;},debug:function(a){b=a||!0;this.log("debugging...","info");this.debugOn=!0},debugOn:!!b}}(jQuery);
Ply.ajax=function(c){return{request:function(b,a,d){var g=b||{},b=g.type||"GET",f=g.url||"",g=g.data||{};if(Ply.core.debugOn)g.debug=!0;try{return c.ajax({type:b,url:f,data:g,success:function(b,d,c){a&&typeof a==="function"&&a(b,d,c)},error:function(a,b,c){Ply.core.log("AjaxError: "+b+" - "+f,"warn");Ply.core.error({name:"AjaxError",message:"Status: "+b,description:"URL: "+f},1);d&&typeof d==="function"&&d(a,b,c)}})}catch(h){Ply.core.log(h.message),Ply.core.error(h,1)}}}}(jQuery);
Ply.read=function(){return{add:function(c,b){if(typeof c==="object")for(var a in c)c.hasOwnProperty(a)&&Ply.read.add(a,c[a]);else this[c]=function(a,c,f){return Ply.ajax.request({url:b,type:"GET",data:a},c,f)}}}}();if(!Object.create)Object.create=function(c){function b(){}if(arguments.length>1)throw Error("Object.create implementation only accepts first parameter.");b.prototype=c;return new b};
Ply.ui=function(c){function b(a,b,g,f,h){var e=this;this.name=a;this.view=b;this.delegate=h;this.options=c.extend({},Ply.config.ui.defaults,this.options,g);this.data=c.extend({},this.data,f);if(this.__objects)this.objects={},this.__bindObjects=function(){for(var a in e.__objects)e.__objects.hasOwnProperty(a)&&(e.objects[a]=e.view.find(e.__objects[a]))},this.__bindObjects();if(this.__partials)this.partials={},this.__bindPartials=function(){for(var a in e.__partials)e.__partials.hasOwnProperty(a)&&
e.objects[a]&&e.objects[a].length&&(e.partials[a]=Ply.ui.register(e.__partials[a],{view:e.objects[a],delegate:e}))},this.__bindPartials();if(this.__notifications)for(var i in this.__notifications)this.__notifications.hasOwnProperty(i)&&Ply.core.listen(i,this[this.__notifications[i]],this);this.__init&&typeof this.__init==="function"&&this.__init();return this}return{fn:{},define:function(a,d){var g=this,f=Ply.config.ui.base||{};Ply.read[a]||Ply.read.add(a,d.__url||Ply.config.read.urlGenerator(a));
this.fn[a]=function(d,c,f,j){return b.call(Object.create(g.fn[a].impl),a,d,c,f,j)};this.fn[a].impl=c.extend(Object.create(f),d);this.fn[a].impl.read=Ply.read[a]},register:function(a,b){var c=Ply.config.ui,b=b&&typeof b==="object"?b:{};if(!(c.onRegister&&typeof c.onRegister==="function"&&c.onRegister(a,b)===!1)){if(!b.view)b.view=c.selectorGenerator(a),Ply.core.log("No view name supplied, implying: "+b.view);return this.start(a,b)}},start:function(a,b){Ply.core.log("trying start: "+a,"info");try{return this.fn[a](c(b.view),
b.options,b.data,b.delegate)}catch(g){if(Ply.core.log(a+" failed to start."),Ply.core.error(g,1),Ply.core.debugOn)throw g;}}}}(jQuery);
Ply.config=function(c){return{core:{onError:function(b,a){c.post("/error/logclienterror",{name:b.name,description:b.description,message:b.message,lineNumber:b.lineNumber,stackTrace:b.stack});a>1&&alert("An error has occurred. Please refresh your browser")}},read:{urlGenerator:function(b){return"/"+b.replace("_","/").replace("-","").toLowerCase()}},ui:{base:{},defaults:{},selectorGenerator:function(b){var b=b.match(/[A-Z]?[a-z]+/g).join("_").toLowerCase(),a=b.split("_")[0],b=a+"_"+b.substr(a.length+
1).replace("_","-");return".view-"+b+", ."+b},onRegister:function(b,a){if(a.modal)a.modal=typeof a.modal==="object"?a.modal:{},c.modal(a.view,{containerId:a.modal.containerId,dataClass:a.modal.dataClass,maxWidth:a.modal.maxWidth||300,maxHeight:a.modal.maxHeight,updateOnOpen:a.modal.updateOnOpen,onShow:function(d){a.view=d.data;Ply.ui.start(b,a);d.data.delegate(".modal-close","click",function(a){a.preventDefault();c.modal.close()})}})}}}}(jQuery);
