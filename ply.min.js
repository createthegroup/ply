window.Ply={VERSION:"0.2.0"};
Ply.core=function(){var c={},b=!1;return{notify:function(a,e,b){for(var g=c[a]||(c[a]=[]),h=0,d=g.length;h<d;h++)g[h].handler.call(g[h].listener,a,e,b)},listen:function(a,e,b){var g=c[a]||(c[a]=[]),a=a.split(/\s/),h=a.length,d=0;if(h>1)for(;d<h;d++)this.listen(a[d],e,b);else g.push({handler:e,listener:b})},log:function(a,e){if(b&&window.console)switch(e){case "warn":console.warn(a);break;case "info":console.info(a);break;default:console.log(a)}},error:function(a,b){if(Ply.config.core.onError&&typeof Ply.config.core.onError===
"function")Ply.config.core.onError(a,b);else throw a;},debug:function(a){b=a||!0;this.log("debugging...","info");this.debugOn=!0},debugOn:!!b}}(jQuery);
Ply.ajax=function(c){return{request:function(b,a,e){var f=b||{},b=f.type||"GET",g=f.url||"",f=f.data||{};if(Ply.core.debugOn)f.debug=!0;try{return c.ajax({type:b,url:g,data:f,success:function(b){a&&typeof a==="function"&&a(b)},error:function(a){Ply.core.log("AjaxError: "+a.status+" - "+g,"warn");Ply.core.error({name:"AjaxError",message:"Status: "+a.status,description:"URL: "+g},1);e&&typeof e==="function"&&e(a)}})}catch(h){Ply.core.log(h.message),Ply.core.error(h,1)}}}}(jQuery);
Ply.read=function(){return{_create:function(c,b){b=b||Ply.config.read.urlGenerator(c);Ply.read[c]=function(a,e,f){return Ply.ajax.request({url:b,type:"GET",data:a},e,f)}}}}();if(!Object.create)Object.create=function(c){function b(){}if(arguments.length>1)throw Error("Object.create implementation only accepts first parameter.");b.prototype=c;return new b};
Ply.ui=function(c){function b(a,b,f,g,h){var d=this;this.name=a;this.view=b;this.delegate=h;this.options=c.extend({},Ply.config.ui.defaults,this.options,f);this.data=c.extend({},this.data,g);if(this.__objects)this.objects={},this.__bindObjects=function(){for(var a in d.__objects)d.__objects.hasOwnProperty(a)&&(d.objects[a]=d.view.find(d.__objects[a]))},this.__bindObjects();if(this.__partials)this.partials={},this.__bindPartials=function(){for(var a in d.__partials)d.__partials.hasOwnProperty(a)&&
d.objects[a]&&d.objects[a].length&&(d.partials[a]=Ply.ui.register(d.__partials[a],{view:d.objects[a],delegate:d}))},this.__bindPartials();if(this.__notifications)for(var i in this.__notifications)this.__notifications.hasOwnProperty(i)&&Ply.core.listen(i,this[this.__notifications[i]],this);this.__init&&typeof this.__init==="function"&&this.__init();return this}return{fn:{},define:function(a,e){var f=this,g=Ply.config.ui.base||{};Ply.read[a]||Ply.read._create(a,e.__url);this.fn[a]=function(e,d,c,g){return b.call(Object.create(f.fn[a].impl),
a,e,d,c,g)};this.fn[a].impl=c.extend(Object.create(g),e);this.fn[a].impl.read=Ply.read[a]},register:function(a,b){var c=Ply.config.ui,b=b&&typeof b==="object"?b:{};if(c.onRegister&&typeof c.onRegister==="function")c.onRegister(a,b);if(!b.view)b.view=c.selectorGenerator(a),Ply.core.log("No view name supplied, implying: "+b.view);return this.start(a,b)},start:function(a,b){Ply.core.log("trying start: "+a,"info");try{return this.fn[a](c(b.view),b.options,b.data,b.delegate)}catch(f){if(Ply.core.log(a+
" failed to start."),Ply.core.error(f,1),Ply.core.debugOn)throw f;}}}}(jQuery);
Ply.config=function(c){return{core:{onError:function(b,a){c.post("/error/logclienterror",{name:b.name,description:b.description,message:b.message,lineNumber:b.lineNumber,stackTrace:b.stack});a>1&&alert("An error has occurred. Please refresh your browser")}},read:{urlGenerator:function(b){return"/"+b.replace("_","/").replace("-","").toLowerCase()}},ui:{base:{},defaults:{},selectorGenerator:function(b){var b=b.match(/[A-Z]?[a-z]+/g).join("_").toLowerCase(),a=b.split("_")[0],b=a+"_"+b.substr(a.length+
1).replace("_","-");return".view-"+b+", ."+b},onRegister:function(b,a){if(a.modal)a.modal=typeof a.modal==="object"?a.modal:{},c.modal(a.view,{containerId:a.modal.containerId,dataClass:a.modal.dataClass,maxWidth:a.modal.maxWidth||300,maxHeight:a.modal.maxHeight,updateOnOpen:a.modal.updateOnOpen,onShow:function(e){a.view=e.data;Ply.ui.start(b,a);e.data.delegate(".modal-close","click",function(a){a.preventDefault();c.modal.close()})}})}}}}(jQuery);
