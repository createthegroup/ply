var Ply={VERSION:"0.1.0"};
Ply.core=function(){var e={},f=!1;return{notify:function(a,b,d){e[a]||(e[a]=[]);for(var c=0,h=e[a].length;c<h;c++)e[a][c].handler.apply(e[a][c].listener,[a,b,d])},listen:function(a,b,d){var c=a.split(/\s/),h=0,g=c.length;if(c.length>1)for(;h<g;h++)this.listen(c[h],b,d);else e[a]||(e[a]=[]),e[a].push({handler:b,listener:d})},log:function(a,b){if(f&&window.console)switch(b){case "warn":console.warn(a);break;case "info":console.info(a);break;default:console.log(a)}},error:function(a,b){jQuery.post(Ply.config.core.errorLoggingUrl,
{name:a.name,description:a.description,message:a.message,lineNumber:a.lineNumber,stackTrace:a.stack});b>1&&alert("An error has occurred. Please refresh your browser")},debug:function(a){f=a||!0;this.log("debugging...","info");this.debugOn=!0},debugOn:!!f}}();
Ply.ajax=function(e){return{request:function(f,a,b){var d=f||{},f=d.type||"GET",c=d.url||"",d=d.data||{};if(Ply.core.debugOn)d.debug=!0;try{return e.ajax({type:f,url:c,data:d,success:function(b){a&&typeof a==="function"&&a(b)},error:function(a){Ply.core.log("AjaxError: "+a.status+" - "+c,"warn");Ply.core.error({name:"AjaxError",message:"Status: "+a.status,description:"URL: "+c},1);b&&typeof b==="function"&&b(a)}})}catch(h){Ply.core.log(h.message),Ply.core.error(h,1)}}}}(jQuery);
Ply.read=function(){return{_create:function(e,f){f=f||Ply.config.read.urlGenerator(e);Ply.read[e]=function(a,b,d){return Ply.ajax.request({url:f,type:"GET",data:a},b,d)}}}}();
Ply.ui=function(e){function f(a,b,d,c,h){var g=this;this.view=b;this.delegate=h;this.opts=e.extend({},Ply.config.ui.defaults,this.opts,d);this.data=e.extend({},this.data,c);this.name=a;if(this.__objects)this.objects={},this.__bindObjects=function(){for(var a in g.__objects)g.__objects.hasOwnProperty(a)&&(g.objects[a]=g.view.find(g.__objects[a]))},this.__bindObjects();if(this.__partials)this.partials={},this.__bindPartials=function(){for(var a in g.__partials)g.__partials.hasOwnProperty(a)&&g.objects[a]&&
g.objects[a].length&&(g.partials[a]=Ply.ui.register(g.__partials[a],{view:g.objects[a],delegate:g}))},this.__bindPartials();if(this.__notifications)for(var f in this.__notifications)this.__notifications.hasOwnProperty(f)&&Ply.core.listen(f,this[this.__notifications[f]],this);this.__init&&typeof this.__init==="function"&&this.__init();return this}return{fn:{},define:function(a,b){var d=this,c=e.extend({},Ply.config.ui.base||{});Ply.read[a]||Ply.read._create(a,b.__url);c.read=Ply.read[a];this.fn[a]=
function(b,c,j,i){return f.call(e.extend({},d.fn[a].impl),a,b,c,j,i)};this.fn[a].impl=e.extend({},c,b)},create:function(a,b){var d=this,c=Array.prototype.slice.call(arguments),b=c[c.length-1],c=c.slice(1,c.length-1);c.push(function(c){b.view=c;d.register(a,b)});Ply.read[a].apply(this,c)},register:function(a,b){b=b||{};if(Ply.config.ui.onRegister&&typeof Ply.config.ui.onRegister==="function")Ply.config.ui.onRegister(a,b);if(!b.view)b.view=Ply.config.ui.selectorGenerator(a),Ply.core.log("No view name supplied, implying: "+
b.view);return this.start(a,b)},start:function(a,b){Ply.core.log("trying start: "+a,"info");try{return this.fn[a](e(b.view),b.options,b.data,b.delegate)}catch(d){if(Ply.core.log(a+" failed to start."),Ply.core.error(d,1),Ply.core.debugOn)throw d;}}}}(jQuery);
