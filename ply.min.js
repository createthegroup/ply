window.Ply={VERSION:"0.1.6"};
Ply.core=function(){var d={},b=!1;return{notify:function(a,c,b){for(var f=d[a]||(d[a]=[]),g=0,e=f.length;g<e;g++)f[g].handler.apply(f[g].listener,[a,c,b])},listen:function(a,c,b){var f=d[a]||(d[a]=[]),a=a.split(/\s/),g=a.length,e=0;if(g>1)for(;e<g;e++)this.listen(a[e],c,b);else f.push({handler:c,listener:b})},log:function(a,c){if(b&&window.console)switch(c){case "warn":console.warn(a);break;case "info":console.info(a);break;default:console.log(a)}},error:function(a,c){if(Ply.config.core.onError&&typeof Ply.config.core.onError===
"function")Ply.config.core.onError(a,c);else throw a;},debug:function(a){b=a||!0;this.log("debugging...","info");this.debugOn=!0;this.debugOn=!1},debugOn:!!b}}(jQuery);
Ply.ajax=function(d){return{request:function(b,a,c){var h=b||{},b=h.type||"GET",f=h.url||"",h=h.data||{};if(Ply.core.debugOn)h.debug=!0;try{return d.ajax({type:b,url:f,data:h,success:function(c){a&&typeof a==="function"&&a(c)},error:function(a){Ply.core.log("AjaxError: "+a.status+" - "+f,"warn");Ply.core.error({name:"AjaxError",message:"Status: "+a.status,description:"URL: "+f},1);c&&typeof c==="function"&&c(a)}})}catch(g){Ply.core.log(g.message),Ply.core.error(g,1)}}}}(jQuery);
Ply.read=function(){return{_create:function(d,b){b=b||Ply.config.read.urlGenerator(d);Ply.read[d]=function(a,c,d){return Ply.ajax.request({url:b,type:"GET",data:a},c,d)}}}}();
Ply.ui=function(d){function b(a,c,b,f,g){var e=this;this.name=a;this.view=c;this.delegate=g;this.opts=d.extend({},Ply.config.ui.defaults,this.opts,b);this.data=d.extend({},this.data,f);if(this.__objects)this.objects={},this.__bindObjects=function(){for(var a in e.__objects)e.__objects.hasOwnProperty(a)&&(e.objects[a]=e.view.find(e.__objects[a]))},this.__bindObjects();if(this.__partials)this.partials={},this.__bindPartials=function(){for(var a in e.__partials)e.__partials.hasOwnProperty(a)&&e.objects[a]&&
e.objects[a].length&&(e.partials[a]=Ply.ui.register(e.__partials[a],{view:e.objects[a],delegate:e}))},this.__bindPartials();if(this.__notifications)for(var i in this.__notifications)this.__notifications.hasOwnProperty(i)&&Ply.core.listen(i,this[this.__notifications[i]],this);this.__init&&typeof this.__init==="function"&&this.__init();return this}return{fn:{},define:function(a,c){var h=this,f=d.extend({},Ply.config.ui.base||{});Ply.read[a]||Ply.read._create(a,c.__url);f.__read=Ply.read[a];this.fn[a]=
function(c,e,f,j){return b.call(d.extend({},h.fn[a].impl),a,c,e,f,j)};this.fn[a].impl=d.extend({},f,c)},register:function(a,c){c=c&&typeof c==="object"?c:{};if(Ply.config.ui.onRegister&&typeof Ply.config.ui.onRegister==="function")Ply.config.ui.onRegister(a,c);if(!c.view)c.view=Ply.config.ui.selectorGenerator(a),Ply.core.log("No view name supplied, implying: "+c.view);return this.start(a,c)},start:function(a,c){Ply.core.log("trying start: "+a,"info");try{return this.fn[a](d(c.view),c.options,c.data,
c.delegate)}catch(b){if(Ply.core.log(a+" failed to start."),Ply.core.error(b,1),Ply.core.debugOn)throw b;}}}}(jQuery);
Ply.config=function(d){return{core:{onError:function(b,a){d.post("/error/logclienterror",{name:b.name,description:b.description,message:b.message,lineNumber:b.lineNumber,stackTrace:b.stack});a>1&&alert("An error has occurred. Please refresh your browser")}},read:{urlGenerator:function(b){return"/"+b.replace("_","/").replace("-","").toLowerCase()}},ui:{base:{},defaults:{},selectorGenerator:function(b){var b=b.match(/[A-Z]?[a-z]+/g).join("_").toLowerCase(),a=b.split("_")[0],b=a+"_"+b.substr(a.length+
1).replace("_","-");return".view-"+b+", ."+b},onRegister:function(b,a){if(a.modal)a.modal=typeof a.modal==="object"?a.modal:{},d.modal(a.view,{containerId:a.modal.containerId,dataClass:a.modal.dataClass,maxWidth:a.modal.maxWidth||300,maxHeight:a.modal.maxHeight,updateOnOpen:a.modal.updateOnOpen,onShow:function(c){a.view=c.data;Ply.ui.start(b,a);c.data.delegate(".modal-close","click",function(a){a.preventDefault();d.modal.close()})}})}}}}(jQuery);
